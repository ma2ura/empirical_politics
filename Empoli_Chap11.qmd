# 回帰分析による統計的推定

```{r}
#| echo: FALSE
library(tidyverse)
library(ggthemes)
mystyle <- list (#  ggplotのテーマ
  theme_few(), # ggthemesパッケージ
  theme(
    text = element_text(
      size=10,  #  フォントサイズ
      family = "HiraKakuProN-W3" # ヒラギノフォント
    )
  )
)
set.seed(123)
```

## 単回帰による統計的推定

### 単回帰モデル

売上高と広告宣伝費の関係を考えるため、前章では散布図(scatter diagram)を使って、2変数の関係を見てみました。
<!---
 観察された売上高と広告宣伝費のデータを使って、
--->
次のような売上高を広告宣伝費で説明するモデルを考えてみます。

```{mermaid}
graph LR
A[広告宣伝費] --> B[売上高]
```

この因果関係を明らかにするため、売上高を応答変数$Y$、広告宣伝費を説明変数$X$として、次のようなモデルを構築します。

$$
Y_i = \beta _0 + \beta_1 X_i
$$

ここで$\beta_0$と$\beta_1$は定数です。
したがって、$X_i$の値が決まれば、応答変数$Y$の値は一意に決まります。
このようなモデルを**決定的モデル**(deterministic model)と呼びます。

ただ現実には、広告宣伝費が同じでも売上高が異なることがあります。
そこで売上高の水準が広告宣伝費だけで決まるのではなく、広告宣伝費では説明しきれない要因があることをモデルで表すために、確率変数である**誤差項**(error term)を回帰モデルに加えたものを考えます。

$$
Y_i = \beta _0 + \beta_1 X_i + \varepsilon_i
$$

現実のデータで，1つの説明変数が応答変数を完全に説明できる(つまりモデル上にすべてのデータが載っている)ことはほとんどないため、確率変数である誤差項を含めたモデルを**確率モデル**(probabilistic model)と呼びます。
本書では単回帰モデルとは、$\varepsilon_i$が正規分布に従うと仮定したモデルを指します。
図で書くと，次のようなモデルです。

```{r}
#| echo: FALSE

x <- seq(-3, 3, length.out = 100)
y <- 0.5 * x + rnorm(100, 0, 1)
df <- data.frame(x, y)
ggplot(df, aes(x, y)) + geom_point() + geom_smooth(method = "lm") + mystyle
```

この回帰モデルが意味をもつためには、誤差項$\varepsilon_i$が平均0で分散$\sigma^2$の正規分布に従うという仮定が必要です。

![図11.1](img/fig_11_1.png){width="60%"}


### 信頼区間と仮説検定

## 重回帰分析による統計的推定

### 重回帰モデル

重回帰でも単回帰でも統計的推定に変わりはありません。
重回帰モデルを以下のように表します。

$$
Y_i = \beta _0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \cdots + \beta_p x_{ik} + \varepsilon_i
$$

この回帰係数$\beta$の推定値$b$を求めることが統計的推定です。

企業の売上高は、前年度の広告宣伝費と研究開発費で説明できる、つまり前年度の広告宣伝費と研究開発費が高いほど、売上高が高くなるのかどうかを考えてみます。

$$
\text{売上高}_t = \beta_0 + \beta_1 \text{広告宣伝費}_{t-1} + \beta_2 \text{研究開発費}_{t-1} + \varepsilon_t
$$

ではこの回帰モデルを推定するためのデータを読み込むため、`tidyverse`の`readr`パッケージの`read_csv()`関数を使って、作業ディレクトリの`data`フォルダの中に保存されている`adv_2023.csv`を読み込みます。

```{r}
df <- read_csv("data/adv_2023.csv")
```

重回帰モデルを推定するには、基本関数の`lm()`を使います。
重回帰モデルの場合、複数の説明変数があるため`+`でつなげていきます。

```{r}
res <- lm(売上高 ~ lag(研究開発費) + lag(広告宣伝費), data = df)
coef(res)
```

上記の推定結果から、

$$
\text{売上高} = 0.00000 + 0.1716 \text{研究開発費}_{t-1} + 6.8131 \text{広告宣伝費}_{t-1}
$$
であることが分かりました。



### 信頼区間と仮説検定


先ほどの回帰係数の推定結果は，1サンプルからの結果であり，サンプルの数を増やせば推定値の分布ができるのは，単回帰分析と同じなので，
ここでも同じ方法で信頼区間を求めることが出来ます。
単回帰分析の場合，切片と回帰係数の2つが推定するパラメータなので，自由度が$n-2$の$t$分布を利用しました。
説明変数が$k$個ある重回帰分析の推定で利用する$t$分布の自由度は，$n-k-1$になります。
$100(1-\alpha)$％信頼区間は，

$$
b_m - t _{n-k-1, \frac{\alpha}{2}} SE(b_m) \leq \beta_m \leq b_m + t_{n-k-1, \frac{\alpha}{2}} SE(b_m)
$$
