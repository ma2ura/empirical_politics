<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rによる計量政治学ノート - 14&nbsp; 交差項の使い方</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Empoli_Chap15.html" rel="next">
<link href="./Empoli_Chap13.html" rel="prev">
<link href="./favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Rによる計量政治学ノート</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">第1回 はじめに</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap01.html" rel="" target="">
 <span class="menu-text">第2回 実証研究</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap02.html" rel="" target="">
 <span class="menu-text">2章 研究テーマの選び方</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap03.html" rel="" target="">
 <span class="menu-text">3章 理論と仮説</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap04.html" rel="" target="">
 <span class="menu-text">4章 Rの使い方</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap05.html" rel="" target="">
 <span class="menu-text">5章 Rによるデータ操作</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap06.html" rel="" target="">
 <span class="menu-text">6章 記述統計と可視化</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap07.html" rel="" target="">
 <span class="menu-text">7章 統計的推定</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap08.html" rel="" target="">
 <span class="menu-text">8章 統計的仮説検定</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap09.html" rel="" target="">
 <span class="menu-text">9章 変数間の関連性</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap10.html" rel="" target="">
 <span class="menu-text">10章 回帰分析の基礎</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap11.html" rel="" target="">
 <span class="menu-text">11章 回帰分析の統計的推定</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap12.html" rel="" target="">
 <span class="menu-text">12章 回帰分析の前提と妥当性の診断</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap13.html" rel="" target="">
 <span class="menu-text">13章 回帰分析の応用</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap14.html" rel="" target="">
 <span class="menu-text">14章 交差項の使い方</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./Empoli_Chap15.html" rel="" target="">
 <span class="menu-text">15章 ロジスティック回帰分析</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://so-ichi.com" rel="" target=""><i class="bi bi-house" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/matsuura_rits" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Empoli_Chap14.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">交差項の使い方</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap01.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">定量研究とは</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">研究テーマの選び方</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">理論と仮説</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Rの使い方</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Rによるデータ操作</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap06.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">記述統計とデータの可視化・視覚化</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap07.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">統計的推定</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap08.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">統計的仮説検定</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap09.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">変数間の関連性</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap10.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">回帰分析の基礎</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">回帰分析による統計的推定</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap12.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">回帰分析の前提と妥当性の診断</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap13.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">回帰分析の応用</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap14.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">交差項の使い方</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Empoli_Chap15.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ロジスティック回帰分析</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#交差項で何が分かるのか" id="toc-交差項で何が分かるのか" class="nav-link active" data-scroll-target="#交差項で何が分かるのか"><span class="header-section-number">14.1</span> 交差項で何が分かるのか</a></li>
  <li><a href="#交差項を入れた回帰分析の注意点" id="toc-交差項を入れた回帰分析の注意点" class="nav-link" data-scroll-target="#交差項を入れた回帰分析の注意点"><span class="header-section-number">14.2</span> 交差項を入れた回帰分析の注意点</a></li>
  <li><a href="#広告宣伝費を事例とした交差項の分析" id="toc-広告宣伝費を事例とした交差項の分析" class="nav-link" data-scroll-target="#広告宣伝費を事例とした交差項の分析"><span class="header-section-number">14.3</span> 広告宣伝費を事例とした交差項の分析</a>
  <ul class="collapse">
  <li><a href="#記述統計と散布図の表示" id="toc-記述統計と散布図の表示" class="nav-link" data-scroll-target="#記述統計と散布図の表示"><span class="header-section-number">14.3.1</span> 記述統計と散布図の表示</a></li>
  <li><a href="#交差項を使った重回帰分析" id="toc-交差項を使った重回帰分析" class="nav-link" data-scroll-target="#交差項を使った重回帰分析"><span class="header-section-number">14.3.2</span> 交差項を使った重回帰分析</a></li>
  <li><a href="#交差項を含む回帰分析結果の解釈と可視化" id="toc-交差項を含む回帰分析結果の解釈と可視化" class="nav-link" data-scroll-target="#交差項を含む回帰分析結果の解釈と可視化"><span class="header-section-number">14.3.3</span> 交差項を含む回帰分析結果の解釈と可視化</a></li>
  </ul></li>
  <li><a href="#まとめ" id="toc-まとめ" class="nav-link" data-scroll-target="#まとめ"><span class="header-section-number">14.4</span> まとめ</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">交差項の使い方</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="交差項で何が分かるのか" class="level2" data-number="14.1">
<h2 data-number="14.1" class="anchored" data-anchor-id="交差項で何が分かるのか"><span class="header-section-number">14.1</span> 交差項で何が分かるのか</h2>
<p>説明変数<span class="math inline">X</span>が応答変数<span class="math inline">Y</span>に与える影響(直接効果)に対して，別の説明変数<span class="math inline">Z</span>が与える影響がある場合，<span class="math inline">X</span>と<span class="math inline">Z</span>の交差項<span class="math inline">X \times Z</span>をモデルに組み入れることで，<span class="math inline">X</span>の影響が<span class="math inline">Z</span>の値によってどのように変化するかを分析することができます。</p>
<p><span class="math display">
Y = \beta_0 + \beta_1 X + \beta_2 Z + \beta_3 X \times Z + \varepsilon
</span></p>
<p>この<span class="math inline">X \times Z</span>を<strong>交差項</strong>(interaction term)とよびます。</p>
<p>前章で導入したダミー変数との交差項は，ダミー変数の値によって，切片や傾きがどのように変化するかを分析することができましたが，ここでは量的変数と量的変数の交差項のケースを考えます。</p>
</section>
<section id="交差項を入れた回帰分析の注意点" class="level2" data-number="14.2">
<h2 data-number="14.2" class="anchored" data-anchor-id="交差項を入れた回帰分析の注意点"><span class="header-section-number">14.2</span> 交差項を入れた回帰分析の注意点</h2>
<p>回帰分析で交差項を入れる場合の注意点は次の4つです。</p>
<ol type="1">
<li>条件付仮説(たとえば，十分に<span class="math inline">Z</span>が大きいとき，<span class="math inline">X</span>は<span class="math inline">Y</span>に影響を与える，とか)を検証する場合に，交差項を使う。</li>
<li>交差項を入れるときは，交差項を構成する変数をそれぞれ回帰モデルに入れる。</li>
<li>交差項を構成する変数の回帰係数はそのまま解釈できない。</li>
<li>分析結果として，限界効果と標準誤差を示す。</li>
</ol>
<p>これは，数式で確認すれば分かりやすいです。 回帰モデルが</p>
<p><span class="math display">
Y = \beta_0 + \beta_1 X + \beta_2 Z + \beta_3 X \times Z + \varepsilon
</span></p>
<p>であるとき，説明変数<span class="math inline">X</span>が応答変数<span class="math inline">Y</span>に与える影響は，<span class="math inline">Y</span>を<span class="math inline">X</span>で偏微分することで求められます。</p>
<p><span class="math display">
\frac{\partial Y}{\partial X} = \beta_1 + \beta_3 Z
</span></p>
<p>この式から，<span class="math inline">X</span>が<span class="math inline">Y</span>に与える影響が<span class="math inline">Z</span>の値によって変化する、ということが分かります。 そのため，<span class="math inline">\beta_1</span>の値だけでは，<span class="math inline">X</span>の影響を正確に評価することができません。また，<span class="math inline">Z</span>の値によって，<span class="math inline">X</span>の影響が変化することを示すためには，<span class="math inline">Z</span>の値を変化させたときの<span class="math inline">\beta_1</span>の値を示す必要があります。これを<strong>限界効果</strong>(marginal effect)とよびます。</p>
</section>
<section id="広告宣伝費を事例とした交差項の分析" class="level2" data-number="14.3">
<h2 data-number="14.3" class="anchored" data-anchor-id="広告宣伝費を事例とした交差項の分析"><span class="header-section-number">14.3</span> 広告宣伝費を事例とした交差項の分析</h2>
<p>以下の分析で利用するためのデータを読み込みます。 ここでも，<code>tidyverse</code>パッケージ群の<code>read_csv()</code>関数を使います。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/adv_2023.csv"</span>) <span class="co"># データの読み込み</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>拡販費) <span class="sc">%&gt;%</span> <span class="co"># 必要ないデータを除去</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(決算月数 <span class="sc">==</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span> <span class="co"># 決算月数が12のデータを抽出</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(広告宣伝費 <span class="sc">&gt;</span> <span class="dv">0</span>)  <span class="co"># 広告宣伝費が0のデータを除去</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,632
Columns: 13
$ 日経会社コード &lt;chr&gt; "0000001", "0000001", "0000003", "0000003", "0000003", …
$ 企業名称       &lt;chr&gt; "極洋", "極洋", "日本水産", "日本水産", "日本水産", "日…
$ 決算期         &lt;chr&gt; "2006/03", "2007/03", "2006/03", "2007/03", "2008/03", …
$ 決算種別       &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10,…
$ 連結基準       &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ 決算月数       &lt;dbl&gt; 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12,…
$ 業種           &lt;dbl&gt; 235341, 235341, 235341, 235341, 235341, 235341, 235341,…
$ 資産合計       &lt;dbl&gt; 65049, 66459, 384819, 404173, 396739, 385462, 383924, 4…
$ 売上高         &lt;dbl&gt; 152899, 157088, 539653, 552871, 533970, 505250, 481574,…
$ 販管費         &lt;dbl&gt; 13702, 14455, 95566, 98200, 100394, 98413, 99938, 10490…
$ 広告宣伝費     &lt;dbl&gt; 304, 279, 2699, 2569, 2953, 2568, 2636, 3160, 3009, 288…
$ 研究開発費     &lt;dbl&gt; 193, 188, 3083, 3377, 3718, 3803, 3994, 4499, 4809, 361…
$ 設備投資額     &lt;dbl&gt; 897, 1841, 17186, 16031, 19105, 28872, 21121, 18633, 16…</code></pre>
</div>
</div>
<p>以下では，応答変数として売上高，説明変数として広告宣伝費と設備投資額を使います。</p>
<section id="記述統計と散布図の表示" class="level3" data-number="14.3.1">
<h3 data-number="14.3.1" class="anchored" data-anchor-id="記述統計と散布図の表示"><span class="header-section-number">14.3.1</span> 記述統計と散布図の表示</h3>
<p>主要変数3つの記述統計をみます。 ここでは<code>summary()</code>関数を使います。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df[, <span class="fu">c</span>(<span class="st">"売上高"</span>, <span class="st">"広告宣伝費"</span>, <span class="st">"設備投資額"</span>, <span class="st">"資産合計"</span>)]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     売上高           広告宣伝費       設備投資額         資産合計       
 Min.   :      54   Min.   :     1   Min.   :      1   Min.   :      25  
 1st Qu.:   26299   1st Qu.:   250   1st Qu.:    771   1st Qu.:   27312  
 Median :   84923   Median :  1284   Median :   3078   Median :   83040  
 Mean   :  448013   Mean   :  9912   Mean   :  28789   Mean   :  592193  
 3rd Qu.:  277604   3rd Qu.:  6158   3rd Qu.:  12271   3rd Qu.:  278223  
 Max.   :30225681   Max.   :509653   Max.   :4069225   Max.   :51936949  
                                     NA's   :540       NA's   :5         </code></pre>
</div>
</div>
<p>これでも良いのですが，<code>skimr</code>パッケージと<code>summarytools</code>パッケージを使うと，より見やすい表を作ることが出来ます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("skimr") # first time only</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(df3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">df3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">8632</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 2%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">売上高</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">448013.23</td>
<td style="text-align: right;">1522677.66</td>
<td style="text-align: right;">54</td>
<td style="text-align: right;">26298.75</td>
<td style="text-align: right;">84923.0</td>
<td style="text-align: right;">277604.00</td>
<td style="text-align: right;">30225681</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">広告宣伝費</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">9911.51</td>
<td style="text-align: right;">34054.36</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">250.00</td>
<td style="text-align: right;">1283.5</td>
<td style="text-align: right;">6158.00</td>
<td style="text-align: right;">509653</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">設備投資額</td>
<td style="text-align: right;">540</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">28788.64</td>
<td style="text-align: right;">156138.90</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">771.25</td>
<td style="text-align: right;">3078.5</td>
<td style="text-align: right;">12270.75</td>
<td style="text-align: right;">4069225</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">資産合計</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">592192.73</td>
<td style="text-align: right;">2348228.18</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">27312.00</td>
<td style="text-align: right;">83040.0</td>
<td style="text-align: right;">278223.00</td>
<td style="text-align: right;">51936949</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>あるいは，<code>summarytools</code>パッケージの<code>descr()</code>関数を使っても見やすい表を作ることが出来ます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("summarytools") # first time only</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(summarytools)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">descr</span>(df3, <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Descriptive Statistics  
df3  
N: 8632  

                        Mean      Std.Dev     Min         Q1     Median          Q3           Max
---------------- ----------- ------------ ------- ---------- ---------- ----------- -------------
      広告宣伝費     9911.51     34054.36    1.00     250.00    1283.50     6161.00     509653.00
        資産合計   592192.73   2348228.18   25.00   27302.00   83040.00   278313.00   51936949.00
      設備投資額    28788.64    156138.90    1.00     770.50    3078.50    12280.50    4069225.00
          売上高   448013.23   1522677.66   54.00   26293.50   84923.00   277652.00   30225681.00

Table: Table continues below

 

                         MAD         IQR     CV   Skewness   SE.Skewness   Kurtosis   N.Valid   Pct.Valid
---------------- ----------- ----------- ------ ---------- ------------- ---------- --------- -----------
      広告宣伝費     1818.41     5908.00   3.44       8.29          0.03      86.44   8632.00      100.00
        資産合計   106096.34   250911.00   3.97      10.91          0.03     165.12   8627.00       99.94
      設備投資額     4215.77    11499.50   5.42      15.22          0.03     285.02   8092.00       93.74
          売上高   107098.58   251305.25   3.40       9.52          0.03     127.38   8632.00      100.00</code></pre>
</div>
</div>
<p>また，<code>summarytools</code>パッケージの<code>dfSummary()</code>関数を使うと，データフレームの形で表を作ることが出来ます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfSummary</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">plain.ascii =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">style        =</span> <span class="st">'grid'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">graph.magnif =</span> <span class="fl">0.85</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">varnumbers =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid.col    =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="at">method =</span> <span class="st">"render"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="container st-container">
<h3 class="anchored">Data Frame Summary</h3>
<h4 class="anchored">df3</h4>
<strong>Dimensions</strong>: 8632 x 4
  <br><strong>Duplicates</strong>: 0
<br>

<table class="table table-striped table-bordered st-table st-table-striped st-table-bordered st-multiline table-sm small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Variable</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Stats / Values</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Freqs (% of Valid)</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Graph</strong></th>
<th class="st-protect-top-border" style="text-align: center;" data-quarto-table-cell-role="th"><strong>Missing</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">売上高 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 448013.2 (1522678)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">54 ≤ 84923 ≤ 30225681</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 251305.2 (3.4)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">8492 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAIMAAABfCAQAAABhaLy5AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfnCQEONhji16CnAAABEElEQVR42u3csU0EMRRF0bNoe6QHqAd6oEpIXjALAkQAi+DezHJin9E4/Kdnxc21D/A7igExrPNx8fjmobg/XfuA39fxsufLrduL1dO1T/pj9VMghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGdf54++FiuuzfnSz7CcNxtuzTK5Sv9bsJT8ebPf6rEeR3hw9z+lc3f7eeSMSwYgAvKRQOwZn3jmYAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMDFUMTQ6NTQ6MjQrMDA6MDDWr2NIAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTAxVDE0OjU0OjI0KzAwOjAwp/Lb9AAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">広告宣伝費 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 9911.5 (34054.4)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 1283.5 ≤ 509653</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 5908 (3.4)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">4878 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAIMAAABfCAQAAABhaLy5AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfnCQEONhji16CnAAABFElEQVR42u3cQUoDQRRF0RPJHt2DrifZg6vUyRtESCATjZh7Z00XdNWBruE/fCpeHr2Bv1EMiGEdLx/ONy6K98Ojt/kTXR72+P3V65XlH4/e7y/UT4EYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBhWDIhhxYAYVgyIYcWAGFYMiGHFgBjW8Z5Fp6szZv/ThNm7GK5PmD3dPan7frBHgR8uv3t+qhHkbxe4h6c6+c26IhHDigF8AR/jEMFn2JNHAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA5LTAxVDE0OjU0OjI0KzAwOjAw1q9jSAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wOS0wMVQxNDo1NDoyNCswMDowMKfy2/QAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">0 (0.0%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">設備投資額 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 28788.6 (156138.9)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">1 ≤ 3078.5 ≤ 4069225</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 11499.5 (5.4)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">5751 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAIMAAABfCAQAAABhaLy5AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfnCQEONhji16CnAAABCklEQVR42u3cQUoDQRRF0RPJHl2E64l7cJU6eYNoSAYSiYF7Z03TUHWKruE/fCpeHr2A/1EMiGEdzx/eb14Ub4dHL/a+nW/2+P3V69WPPh696j+tnwIxrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGBDDigExrBgQw4oBMawYEMOKATGsGHAxS/ZWp6sDd59/2O4Pht8Nzj095+jys8M7POcO7l13A2JYMYAvNTMLAbyN8EQAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMDFUMTQ6NTQ6MjQrMDA6MDDWr2NIAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTAxVDE0OjU0OjI0KzAwOjAwp/Lb9AAAAD10RVh0aWNjOmNvcHlyaWdodABDb3B5cmlnaHQgMjAwNyBBcHBsZSBJbmMuLCBhbGwgcmlnaHRzIHJlc2VydmVkLp5m3CkAAAAjdEVYdGljYzpkZXNjcmlwdGlvbgBHZW5lcmljIFJHQiBQcm9maWxlGqc4jgAAAABJRU5ErkJggg==" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">540 (6.3%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">資産合計 [numeric]</td>
<td style="text-align: left; padding: 8; vertical-align: middle;"><table data-quarto-postprocess="true" class="table table-sm table-striped small">
<tbody>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">Mean (sd) : 592192.7 (2348228)</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">min ≤ med ≤ max:</td>
</tr>
<tr class="odd" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">25 ≤ 83040 ≤ 51936949</td>
</tr>
<tr class="even" style="background-color:transparent">
<td style="text-align: left; padding: 0; margin: 0; border: 0;">IQR (CV) : 250911 (4)</td>
</tr>
</tbody>
</table></td>
<td style="text-align: left; vertical-align: middle;">8480 distinct values</td>
<td style="text-align: left; vertical-align: middle; padding: 0; background-color: transparent;"><img src="data:image/png;base64,%20iVBORw0KGgoAAAANSUhEUgAAAIMAAABfCAQAAABhaLy5AAAAAmJLR0QA/4ePzL8AAAAHdElNRQfnCQEONhji16CnAAABCElEQVR42u3csVHDUBRFwTXjHimCeqAHqoTkBgZM5LHl4JxMIwVPq9EP3+lL8XL0AM9RDIhhnS8vPv45KN5OR495jy5f9vzz1uuVxz+PnvcB9VMghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQNiWDEghhUDYlgxIIYVA2JYMSCGFQP+7JK93vuNO7mffyXvL4b7rM+9lfFOXXyc03NO+Og6GxDDigF8AwUpCwEZdPdwAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDIzLTA5LTAxVDE0OjU0OjI0KzAwOjAw1q9jSAAAACV0RVh0ZGF0ZTptb2RpZnkAMjAyMy0wOS0wMVQxNDo1NDoyNCswMDowMKfy2/QAAAA9dEVYdGljYzpjb3B5cmlnaHQAQ29weXJpZ2h0IDIwMDcgQXBwbGUgSW5jLiwgYWxsIHJpZ2h0cyByZXNlcnZlZC6eZtwpAAAAI3RFWHRpY2M6ZGVzY3JpcHRpb24AR2VuZXJpYyBSR0IgUHJvZmlsZRqnOI4AAAAASUVORK5CYII=" class="img-fluid" style="border:none;background-color:transparent;padding:0;max-width:max-content;"></td>
<td style="text-align: center;">5 (0.1%)</td>
</tr>
</tbody>
</table>

<p>Generated by <a href="https://github.com/dcomtois/summarytools">summarytools</a> 1.0.1 (<a href="https://www.r-project.org/">R</a> version 4.2.2)<br>2023-09-01</p>
</div>
</div>
</div>
<p>好きな方法を使ってください。</p>
<p>次に，散布図を描きます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> 設備投資額, <span class="at">y =</span> 売上高)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"設備投資額"</span>, <span class="at">y =</span> <span class="st">"売上高"</span>) <span class="sc">+</span> mystyle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Empoli_Chap14_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<p>設備投資額が多い企業ほど売上高が多いように見えますが，因果関係を明らかにするためにも，広告宣伝費と翌期の売上高の散布図を書いてみます。ついでに両変数を対数変換して，分布を正規分布に近づけておきます。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="sc">%&gt;%</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    K_設備投資額 <span class="ot">=</span> <span class="fu">lag</span>(設備投資額) <span class="sc">/</span> <span class="fu">lag</span>(資産合計),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    K_売上高 <span class="ot">=</span> 売上高 <span class="sc">/</span> <span class="fu">lag</span>(資産合計)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> K_設備投資額, <span class="at">y =</span> K_売上高) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"基準化済み前期設備投資額"</span>, <span class="at">y =</span> <span class="st">"基準化済み売上高"</span>) <span class="sc">+</span> mystyle</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Empoli_Chap14_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="1344"></p>
</div>
</div>
<p>次に，この設備投資額と売上高の関係に広告宣伝費がどのような影響を与えているのかを調べるために，回帰モデルに交差項を組み込んでいきます。</p>
</section>
<section id="交差項を使った重回帰分析" class="level3" data-number="14.3.2">
<h3 data-number="14.3.2" class="anchored" data-anchor-id="交差項を使った重回帰分析"><span class="header-section-number">14.3.2</span> 交差項を使った重回帰分析</h3>
<p>ここでは，次のような仮説を考えてみます。</p>
<blockquote class="blockquote">
<p>広告宣伝費が多い企業ほど，設備投資額が多いと，売上高が増加する。</p>
</blockquote>
<p>この仮説を検証するために，回帰モデルを次のように設定します。</p>
$$
<span class="math display">\begin{aligned}
\log \text{売上高} = \beta_0 &amp;+ \beta_1 \log \text{前期設備投資額} + \beta_2 \log \text{広告宣伝費} \\

&amp; + \beta_3 \log \text{前期設備投資額} \times \log \text{広告宣伝費} + \varepsilon
\end{aligned}</span>
<p>$$</p>
<p>これを<code>lm()</code>関数を使って回帰分析を行います。 <code>lm()</code>関すで交差項を含む回帰モデルを作るときは，<code>*</code>を使います。 推定結果を<code>modelsummary</code>パッケージを使って表示します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>res01 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(売上高) <span class="sc">~</span> <span class="fu">log</span>(設備投資額) <span class="sc">*</span> <span class="fu">log</span>(広告宣伝費), <span class="at">data =</span> df3)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(res01,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">"*"</span> <span class="ot">=</span> .<span class="dv">10</span>, <span class="st">"**"</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">"***"</span> <span class="ot">=</span> .<span class="dv">01</span>),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|logLik"</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">6.819***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.087)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(設備投資額)</td>
<td style="text-align: center;">0.397***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.012)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(広告宣伝費)</td>
<td style="text-align: center;">-0.012</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.013)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log(設備投資額) × log(広告宣伝費)</td>
<td style="text-align: center;">0.025***</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1px;"></td>
<td style="text-align: center; box-shadow: 0px 1px;">(0.001)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">8092</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.823</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2 Adj.</td>
<td style="text-align: center;">0.823</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log.Lik.</td>
<td style="text-align: center;">-9015.976</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F</td>
<td style="text-align: center;">12548.404</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">0.74</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01</td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<p>この結果から，設備投資と売上高の正の関係は，広告宣伝費が大きくなるほど強くなる，ということが分かりました。 この結果の解釈を容易にするために，<code>margins</code>パッケージを使って限界効果を計算します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("margins") # first time only</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(margins)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">margins</span>(res01)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 設備投資額 広告宣伝費
  0.0001487  0.0001997</code></pre>
</div>
</div>
<p>この限界効果の推定から，広告宣伝費が増加すると，設備投資と売上高の正の関係が強くなることが分かります。</p>
</section>
<section id="交差項を含む回帰分析結果の解釈と可視化" class="level3" data-number="14.3.3">
<h3 data-number="14.3.3" class="anchored" data-anchor-id="交差項を含む回帰分析結果の解釈と可視化"><span class="header-section-number">14.3.3</span> 交差項を含む回帰分析結果の解釈と可視化</h3>
<p>上の分析結果から，設備投資額と売上高との関係は，広告宣伝費の規模に応じて変化することが分かりました。 しかし，前述した通り設備投資額が売上高に与える影響の強さは，広告宣伝費に応じて決まるため，設備投資額が1円増えたとき，売上高がいくら増えるのかはこの推定結果からは分かりません。</p>
<p>そこで，説明変数を中心化することで，推定結果を解釈可能なものにします。 前章と同様に，中心化するために，各説明変数から標本平均を引きます。 ここでは，<code>scale()</code>関数を使って中心化します。</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    log広告宣伝費<span class="at">_c =</span> <span class="fu">scale</span>(<span class="fu">log</span>(広告宣伝費)),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    log設備投資額<span class="at">_c =</span> <span class="fu">scale</span>(<span class="fu">log</span>(設備投資額))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>res02 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(売上高) <span class="sc">~</span> log設備投資額_c <span class="sc">*</span> log広告宣伝費_c, <span class="at">data =</span> df3)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(res02,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="fu">c</span>(<span class="st">"*"</span> <span class="ot">=</span> .<span class="dv">10</span>, <span class="st">"**"</span> <span class="ot">=</span> .<span class="dv">05</span>, <span class="st">"***"</span> <span class="ot">=</span> .<span class="dv">01</span>),</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">gof_omit =</span> <span class="st">"AIC|BIC|logLik"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">&nbsp;(1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: center;">11.331***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.009)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log設備投資額_c</td>
<td style="text-align: center;">1.251***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.011)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log広告宣伝費_c</td>
<td style="text-align: center;">0.429***</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: center;">(0.011)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">log設備投資額_c × log広告宣伝費_c</td>
<td style="text-align: center;">0.124***</td>
</tr>
<tr class="even">
<td style="text-align: left; box-shadow: 0px 1px;"></td>
<td style="text-align: center; box-shadow: 0px 1px;">(0.007)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Num.Obs.</td>
<td style="text-align: center;">8092</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: center;">0.823</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R2 Adj.</td>
<td style="text-align: center;">0.823</td>
</tr>
<tr class="even">
<td style="text-align: left;">Log.Lik.</td>
<td style="text-align: center;">-9015.976</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F</td>
<td style="text-align: center;">12548.404</td>
</tr>
<tr class="even">
<td style="text-align: left;">RMSE</td>
<td style="text-align: center;">0.74</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td style="text-align: left; padding: 0;"><sup></sup> * p &lt; 0.1, ** p &lt; 0.05, *** p &lt; 0.01</td>
<td style="text-align: center;"></td>
</tr>
</tfoot>

</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df3 <span class="ot">&lt;-</span> df3 <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    log広告宣伝費 <span class="ot">=</span> <span class="fu">log</span>(広告宣伝費),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    log設備投資額 <span class="ot">=</span> <span class="fu">log</span>(設備投資額),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    log広告宣伝費<span class="at">_c =</span> log広告宣伝費 <span class="sc">-</span> <span class="fu">mean</span>(log広告宣伝費),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    log設備投資額<span class="at">_c =</span> log設備投資額 <span class="sc">-</span> <span class="fu">mean</span>(log設備投資額)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="まとめ" class="level2" data-number="14.4">
<h2 data-number="14.4" class="anchored" data-anchor-id="まとめ"><span class="header-section-number">14.4</span> まとめ</h2>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Empoli_Chap13.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">回帰分析の応用</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Empoli_Chap15.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">ロジスティック回帰分析</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">計量会計学のノート</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">本書は <a href="https://quarto.org/">Quarto</a> で作成されました。</div>
  </div>
</footer>



</body></html>